<!DOCTYPE html>
<html lang="es" xmlns="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.4/font/bootstrap-icons.css">
	<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>
	<script  src="../static/js/graphs.js"></script>

</head>
	<body class="bg-black">
    	<nav th:replace="~{fragments/navBar::navBar}"></nav>
    	<hr />
    	<main class="min-vh-100">
			<section id="banca" class="w-100 mb-5">
				<h1 class="text-center">PRESS BANCA <a th:href="@{/mypage/exercise/bench/add}"><i class="bi bi-plus-square-fill text-warning"></i></a></h1>
				<table class="table table-hover table-light rounded-2 w-75 m-auto text-center" >
					<thead>
						<tr>
							<th>KGS</th>
							<th>REPS</th>
							<th>RM ESTIMADO</th>
							<th>FECHA DE REALIZACIÓN</th>
							<th>EDITAR/BORRAR</th>		
						</tr>
					</thead>
					<tbody>
						<tr th:each="bench : ${benchList}" >
							<td th:text="${bench.kgs}"></td>
							<td th:text="${bench.reps}"></td>
							<td th:text="${bServ.calculateRM(bench)}" class="bench1RM"></td>
							<td th:text="${bench.fecha}" class="benchDate"></td>
							<td><a th:href="@{/mypage/exercise/bench/edit/{idBp}(idBp = ${bench.idBp})}"><i class="bi bi-pencil-square text-warning"></i></a>/<a th:href="@{/mypage/exercise/bench/delete/{idBp}(idBp = ${bench.idBp})}"><i class="bi bi-trash3 text-warning"></i></a></td>
						</tr>
					</tbody>
				</table>
				<canvas id="benchGraph" style="width:100%;max-width:700px" class="m-auto mt-3 border border-warning border-1"></canvas>
				<script>
					const canvasB = document.getElementById('benchGraph');

					const prBElements = document.getElementsByClassName('bench1RM');
					
					
					const dateBElements = document.getElementsByClassName('benchDate');
					
					
					let benchData = [];
					let benchChart;
					function updateBenchChart() {
						for (let i = 0; i < prBElements.length; i++) {
							benchData.push(
								{
									x: dateBElements[i].textContent,
									y: parseFloat(prBElements[i].textContent)
								}
							);
						}
					
					
						const ctxB = canvasB.getContext('2d');
					
						if (benchChart) {
							benchChart.destroy();
						}
					
						benchChart = new Chart(ctxB, {
							type: 'line',
							data: {
								datasets: [{
									label: 'Progreso en Press Banca',
									data: benchData,
									fill: 'origin',
									backgroundColor: 'rgba(85, 0, 0, 0.2)', 
									borderColor: 'rgba(85, 0, 0, 1)', 
									borderWidth: 2 
								}]
							},
							options: {
								responsive: true,
								scales: {
									x: {
										type: 'time',
										time: {
											unit: 'day'
										},
										title: {
											display: true,
											text: 'Date'
										}
									},
									y: {
										title: {
											display: true,
											text: 'PR Estimado'
										}
									}
								}
							}
						});
					}
					
					updateBenchChart();
				</script>
			</section>
			<section id="banca" class="w-100 mb-5">
				<h1 class="text-center">SENTADILLA <a th:href="@{/mypage/exercise/squat/add}"><i class="bi bi-plus-square-fill text-warning"></i></a></h1>
				<table class="table table-hover table-light rounded-2 w-75 m-auto text-center" >
					<thead>
						<tr>
							<th>KGS</th>
							<th>REPS</th>
							<th>RM ESTIMADO</th>
							<th>FECHA DE REALIZACIÓN</th>
							<th>EDITAR/BORRAR</th>
						</tr>
					</thead>
					<tbody>
						<tr th:each="squat : ${squatList}" >
							<td th:text="${squat.kgs}"></td>
							<td th:text="${squat.reps}"></td>
							<td th:text="${sServ.calculateRM(squat)}" class="squat1RM"></td>
							<td th:text="${squat.fecha}" class="squatDate"></td>
							<td><a th:href="@{/mypage/exercise/squat/edit/{idSq}(idSq= ${squat.idSq})}"><i class="bi bi-pencil-square text-warning"></i></a>/<a th:href="@{/mypage/exercise/squat/delete/{idSq}(idSq = ${squat.idSq})}"><i class="bi bi-trash3 text-warning"></i></a></td>
						</tr>
					</tbody>
				</table>
				<canvas id="squatGraph" style="width:100%;max-width:700px" class="m-auto mt-3 border border-warning border-1"></canvas>
				<script>
					const canvasS = document.getElementById('squatGraph');

					const prSElements = document.getElementsByClassName('squat1RM');
					
					
					const dateSElements = document.getElementsByClassName('squatDate');
					
					
					let squatData = [];
					let squatChart;

					function updateSquatChart() {
						for (let i = 0; i < prSElements.length; i++) {
							squatData.push(
								{
									x: dateSElements[i].textContent,
									y: parseFloat(prSElements[i].textContent)
								}
							);
						}
					
					
						const ctxS = canvasS.getContext('2d');
					
						if (squatChart) {
							squatChart.destroy();
						}
					
						squatChart = new Chart(ctxS, {
							type: 'line',
							data: {
								datasets: [{
									label: 'Progreso en Sentadilla',
									data: squatData,
									fill: 'origin',
									backgroundColor: 'rgba(85, 0, 0, 0.2)', 
									borderColor: 'rgba(85, 0, 0, 1)', 
									borderWidth: 2 
								}]
							},
							options: {
								responsive: true,
								scales: {
									x: {
										type: 'time',
										time: {
											unit: 'day'
										},
										title: {
											display: true,
											text: 'Date'
										}
									},
									y: {
										title: {
											display: true,
											text: 'PR Estimado'
										}
									}
								}
							}
						});
					}
					
					updateSquatChart();
				</script>
			</section>
			<section id="banca" class="w-100 mb-5">
				<h1 class="text-center">PESO MUERTO <a th:href="@{/mypage/exercise/deadlift/add}"><i class="bi bi-plus-square-fill text-warning"></i></a></h1>
				<table class="table table-hover table-light rounded-2 w-75 m-auto text-center" >
					<thead>
						<tr>
							<th>KGS</th>
							<th>REPS</th>
							<th>RM ESTIMADO</th>
							<th>FECHA</th>
							<th>EDITAR/BORRAR</th>
						</tr>
					</thead>
					<tbody>
						<tr th:each="dl : ${dlList}" >
							<td th:text="${dl.kgs}"></td>
							<td th:text="${dl.reps}"></td>
							<td th:text="${dServ.calculateRM(dl)}" class="dl1RM"></td>
							<td th:text="${dl.fecha}" class="dlDate"></td>
							<td><a th:href="@{/mypage/exercise/deadlift/edit/{idDl}(idDl = ${dl.idDl})}"><i class="bi bi-pencil-square text-warning"></i></a>/<a th:href="@{/mypage/exercise/deadlift/delete/{idDl}(idDl = ${dl.idDl})}"><i class="bi bi-trash3 text-warning"></i></a></td>
						</tr>
					</tbody>
				</table>
				<canvas id="dlGraph" style="width:100%;max-width:700px" class="m-auto mt-3 border border-warning border-1"></canvas>
				<script>
					const canvaD = document.getElementById('dlGraph')
					const dlPRs = document.getElementsByClassName('dl1RM');
					const dlDates = document.getElementsByClassName('dlDate');

					let dlData = [];
					let dlChart;

					function updateDlGraph(){
						for(let i = 0; i < dlPRs.length; i++){
							dlData.push(
								{
									x: dlDates[i].textContent,
									y: parseFloat(dlPRs[i].textContent)
								}
							)
						}

						let ctxD = canvaD.getContext('2d')

						if(dlChart){
							dlChart.destroy;
						}

						dlChart = new Chart(ctxD, {
							type: 'line',
							data: {
								datasets: [{
									label: 'Progreso en Peso Muerto',
									data: dlData,
									fill: 'origin',
									backgroundColor: 'rgba(85, 0, 0, 0.2)', 
									borderColor: 'rgba(85, 0, 0, 1)', 
									borderWidth: 2 
								}]
							},
							options: {
								responsive: true,
								scales: {
									x: {
										type: 'time',
										time: {
											unit: 'day'
										},
										title: {
											display: true,
											text: 'Date'
										}
									},
									y: {
										title: {
											display: true,
											text: 'PR Estimado'
										}
									}
								}
							}
						})
					}
					updateDlGraph();
				</script>
			</section>
		</main>
    	<footer  th:replace="~{fragments/footer::footer}"></footer>   
<body>
</html>